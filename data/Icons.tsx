import React from 'react';

// Cache de imágenes para el Canvas
const IMAGE_CACHE: Record<string, HTMLImageElement> = {};

// Definiciones de SVG Crudos (Strings)
const SVG_DEFS: Record<string, string> = {
  'class_warrior': `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
      style="height: 512px; width: 512px;">
      <circle cx="256" cy="256" r="256" fill="#000000" fill-opacity="1"></circle>
      <g transform="translate(0,0)">
        <path d="M256 32C253.671 32.582 251.316 33.22 248.95 33.887C248.65 70.127 246.48 113.575 230.893 155.416L256 150.852L281.318 155.455C265.52 113.885 263.348 70.277 263.051 33.887C260.71 33.223 258.36 32.594 256 32Z" class="" fill="#c9c9c9" fill-opacity="1"></path><path d="M230.846 39.744C175.566 59.974 116.335 103.529 98.512 179.486L210.006 159.215C227.022 119.882 230.24 77.131 230.846 39.745Z" class="" fill="#c9c9c9" fill-opacity="1"></path><path d="M281.156 39.744C281.771 77.36 285.036 120.322 302.32 159.274L413.488 179.486C395.666 103.53 336.436 59.975 281.156 39.744Z" class="" fill="#c9c9c9" fill-opacity="1"></path><path d="M247 170.785L84.893 200.258C79.975 206.216 77 214.932 77 224C77 232.727 79.773 241.108 84.355 247.049C94.31 247.065 114.832 247.192 138.689 249.027C165.112 251.06 193.342 254.607 212.025 263.949L215.359 265.617L216.539 269.154C225.298 295.431 228.977 339.301 230.99 381.572C232.907 421.83 232.973 458.868 232.977 476.25L256 499.273L279.02 476.253C279.022 451.995 279.079 414.213 281.012 375.551C283.027 335.251 286.797 295.147 295.461 269.154L296.641 265.617L299.975 263.949C318.658 254.608 346.888 251.059 373.311 249.027C397.168 247.192 417.69 247.065 427.645 247.049C432.227 241.109 435 232.727 435 224C435 214.932 432.025 206.216 427.107 200.258L265 170.785L265 288L247 288L247 170.785Z" class="" fill="#c9c9c9" fill-opacity="1"></path><path d="M224 196L232 236C216 236 96 240 96 224C96 208 192 196 224 196Z" class="" fill="#000000" fill-opacity="1"></path><path d="M288 196C320 196 416 208 416 224C416 240 296 236 280 236L288 196Z" class="" fill="#000000" fill-opacity="1"></path><path d="M84.768 265.018L64 400C114.299 412.575 164.598 425.157 214.896 453.266C214.722 433.997 214.256 408.589 213.01 382.428C211.124 342.829 207.104 301.306 200.514 278.582C186.261 272.749 160.926 268.789 137.311 266.972C115.224 265.274 95.161 265.05 84.768 265.018Z" class="" fill="#9b9b9b" fill-opacity="1"></path><path d="M427.232 265.018C416.839 265.05 396.776 265.274 374.689 266.973C351.059 268.79 325.709 272.753 311.461 278.592C304.807 301.17 300.871 338.801 298.988 376.449C297.622 403.773 297.202 431.039 297.068 453.287C347.38 425.165 397.69 412.577 448 400L427.232 265.018Z" class="" fill="#9b9b9b" fill-opacity="1"></path><path d="M113.766 311.174L193.766 327.174L190.234 344.826L110.234 328.826L113.766 311.174Z" class="" fill="#000000" fill-opacity="1"></path><path d="M398.234 311.174L401.766 328.826L321.766 344.826L318.234 327.174L398.234 311.174Z" class="" fill="#000000" fill-opacity="1"></path><path d="M97.658 357.154L193.658 375.154L190.342 392.846L94.342 374.846L97.658 357.154Z" class="selected" fill="#000000" fill-opacity="1"></path><path d="M414.342 357.154L417.658 374.846L321.658 392.846L318.342 375.154L414.342 357.154Z" class="" fill="#000000" fill-opacity="1"></path>
      </g>
    </svg>
  `,
  'class_mage': `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
      style="height: 512px; width: 512px;">
     <circle cx="256" cy="256" r="256" fill="#000000" fill-opacity="1"></circle>
     <g class="" transform="translate(-22,1)" style="">
        <path d="M416.125 42.406c-57.576.457-104.863 25.804-144.813 64.875-41.984 41.063-75 97.61-100 155.5.78 4.503 3.06 8.946 7.094 13.658 5.158 6.024 13.183 12.113 23.188 17.593 20.01 10.962 47.79 19.545 75.5 24.47 27.71 4.925 55.505 6.21 75.156 3.438 9.825-1.386 17.538-3.91 21.813-6.563 4.274-2.653 4.916-3.957 4.812-6.625l.72-.03c-3.408-42.828-6-88.797.092-131.94 2.82-19.972 7.668-39.434 15.22-57.624-31.573 31.44-62.918 65.425-86.844 94.72 35.418-70.2 86.2-121.398 141.125-168.97-11.376-1.71-22.42-2.584-33.063-2.5zM155.21 238.994a406.802 406.802 0 0 0-13.334.131c-23.138.575-44.227 2.91-61.876 7.188-23.532 5.703-40.466 14.888-48.78 26.03-8.317 11.144-10.08 24.667-.97 45.532 32.86 75.263 117.185 130.26 207.844 148.594 90.66 18.33 186.108.147 242.28-66.75 13.59-16.185 15.297-29.312 9.938-43.22-5.358-13.908-19.586-28.878-40.78-42.75-14.745-9.65-32.683-18.737-52.75-27.03 1.506 22.59 3.555 44.877 5.124 65.967v.219c.607 11.402-5.49 21.585-14.344 27.938-8.853 6.353-20.268 10.08-33.437 12.406-26.337 4.654-60.026 3.398-93.344-2.188-33.317-5.585-66.085-15.466-90.28-29.312-12.097-6.923-22.145-14.85-28.875-24.47-6.73-9.617-9.76-21.554-6.594-33.374l.095-.375.125-.374c7.637-21.206 16.308-42.79 26.094-64.094a634.04 634.04 0 0 0-6.133-.068zm6.634 46.662A839.14 839.14 0 0 0 153.031 309c-1.595 6.246-.4 11.407 3.907 17.563 4.374 6.25 12.28 12.923 22.844 18.968 21.128 12.09 52.4 21.78 84.095 27.095 31.694 5.314 64.016 6.28 87 2.22 11.492-2.032 20.53-5.42 25.78-9.19 5.25-3.766 6.864-6.726 6.595-11.78-.517-6.93-1.088-14.027-1.688-21.25-7.448 4.03-16.47 6.367-26.718 7.813-22.732 3.206-51.79 1.665-81.03-3.532-29.242-5.196-58.5-14.055-81.22-26.5-11.36-6.222-21.122-13.34-28.375-21.812a58.994 58.994 0 0 1-2.376-2.938z" fill="#4a90e2" fill-opacity="1" transform="translate(25.6, 25.6) scale(0.9, 0.9) rotate(0, 256, 256) skewX(0) skewY(0)"></path>
      </g>
    </svg>
  `,
   'class_rogue': `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" 
      style="height: 512px; width: 512px;">
    <circle cx="256" cy="256" r="256" fill="#000000" fill-opacity="1"></circle>
    <g class="" transform="translate(0,0)" style="">
        <path d="M254.1 18.63C172.7 18.63 22.67 174.6 82.47 319.4C90.47 344.7 110.3 369.8 131.6 396.5C156 427.1 183.2 459.7 200.3 493.4L220.8 493.4C202.7 453.6 172.3 417.5 146.2 384.8C118.8 350.5 97.47 319.6 97.47 296.9C97.57 287.8 99.7 278.8 103 270.6C126 209.2 217 150.9 251.5 135.6L255.1 133.6L259 134.9C319.9 155.8 388.3 201.6 413 270.6C417.1 282.3 418.9 288.6 418.6 297.9C418.1 313.7 394.1 352.6 363.6 386.6C334.5 419 301.2 454.3 283.6 493.3L304.1 493.3C320.9 461.1 350.3 429.3 377.4 399.1C400.6 373.5 422.7 349.1 432.3 324.3C485.2 200.3 333.1 18.63 254.1 18.63Z" class="" fill="#420b72" fill-opacity="1"></path><path d="M254.9 154.1C216.2 175.6 169.8 206.3 141.2 242.3C150.9 325.3 200.2 388.4 259.5 388.4C318.7 388.4 367.8 325.7 377.7 243.1C348.8 201 299.7 170.2 254.9 154.1Z" class="" fill="#151310" fill-opacity="1"></path><path d="M196.6 237.1L199 237.1C212.1 237.2 225.1 239.8 238.1 244.5C221.3 285.1 179.1 286.5 160 244.5C172.2 239.7 184.4 237.3 196.6 237.1Z" class="selected" fill="#ffffff" fill-opacity="1"></path><path d="M321.5 237.1C334.5 237 347.5 239.4 360.6 244.5C341.4 286.5 299.3 285.1 282.4 244.5C295.5 239.8 308.5 237.2 321.5 237.1Z" class="" fill="#ffffff" fill-opacity="1"></path>
      </g>
    </svg>
  `,
  'class_priest': `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" 
style="height: 512px; width: 512px;"><circle cx="256" cy="256" r="256" fill="#000000" fill-opacity="1">
</circle><g class="" transform="translate(0,-14)" style="">
<path d="M247 29.337L247 52.337L224 52.337L224 70.337L247 70.337L247 101.047C250.042 100.587 253.046 100.337 256 100.337C258.954 100.337 261.958 100.587 265 101.047L265 70.337L288 70.337L288 52.337L265 52.337L265 29.337L247 29.337Z" class="selected" fill="#f8e71c" fill-opacity="1"></path><path d="M256 118.337C253.87 118.337 251.52 118.619 249 119.142L249 428.942C253.678 428.788 258.322 428.788 263 428.942L263 119.142C260.48 118.619 258.13 118.337 256 118.337Z" class="" fill="#f8e71c" fill-opacity="1"></path><path d="M230.998 125.655C213.508 134.113 192.44 149.385 172.986 168.775C142.692 198.973 115.376 238.36 104.57 272.083C86.51 328.437 103.4 389.85 132.994 450.839C176.842 439.902 205.814 433.047 230.998 430.256L230.998 125.655Z" class="" fill="#ffffff" fill-opacity="1"></path><path d="M281.002 125.655L281.002 430.257C306.185 433.047 335.158 439.903 379.006 450.839C408.601 389.849 425.489 328.436 407.43 272.082C396.623 238.359 369.308 198.972 339.014 168.775C319.56 149.385 298.491 134.112 281.002 125.655Z" class="" fill="#ffffff" fill-opacity="1"></path><path d="M256 446.337C252.22 446.337 248.442 446.37 244.676 446.427C218.99 448.017 190.253 455.05 141.068 467.349L148.725 482.662C250.552 453.667 261.448 453.667 363.275 482.662L370.932 467.348C321.747 455.048 293.01 448.015 267.324 446.425C263.558 446.368 259.779 446.335 256 446.335Z" class="" fill="#f8e71c" fill-opacity="1"></path>
</g>
</svg>

  `,
  'class_barbarian': `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="height: 512px; width: 512px;"><circle cx="256" cy="256" r="256" fill="#000" fill-opacity="1"></circle><g class="" transform="translate(0,17)" style=""><g><path d="M127.4 14.4C53.12 118.8 122.1 138.9 164.9 162.5C172.3 146.4 180.8 131.8 192.2 118.1C140.2 96 130.8 47.9 127.4 14.4Z" class="" fill="#fff" fill-opacity="1"></path><path d="M384.6 14.4C381.2 47.9 371.8 96 319.8 118.1C331.2 131.8 339.7 146.4 347.1 162.5C390 138.9 458.8 118.8 384.6 14.4Z" class="" fill="#fff" fill-opacity="1"></path><path d="M256 89.5C210.7 117.1 193.7 143.9 177.6 184.3C225.5 196 286.4 196 334.4 184.3C318.3 143.9 301.3 117.1 256 89.5Z" class="" fill="#9b9b9b" fill-opacity="1"></path><path d="M148.8 196.1C143.5 206.4 124.2 270.8 124 287.9C128.7 283 133.5 278 138.2 273L144.8 278.8C145.9 253.2 157.4 226 169.9 201.3C163.4 199.7 155.4 198 148.8 196.1Z" class="" fill="#a52604" fill-opacity="1"></path><path d="M363.2 196.1C357 197.8 347.9 200 342.1 201.3C354.5 226 366.1 253.2 367.1 278.8L373.8 273L388 287.9C398.5 275.5 368.5 206.4 363.2 196.1Z" class="" fill="#a82204" fill-opacity="1"></path><path d="M189.6 204.9L181.7 228.7C204.5 235.2 225.3 241.3 250.7 248.7L244.2 265.7C238.6 264.1 232.8 262.5 227.1 260.8C224.2 266.6 217.6 270.4 210.4 270.4C200.2 270.4 192.1 263.2 192.1 254.4C192.1 253.1 192.2 251.9 192.5 250.7L175.9 246L162 287.7L198.1 322L212.7 295L299.2 295L313.9 322L350 287.7L336.1 246C330.7 247.5 325.3 249 320 250.6C320.4 251.8 320.5 253.1 320.5 254.4C320.5 263.2 312.4 270.4 302.1 270.4C294.8 270.4 288.2 266.5 285.3 260.7C279.4 262.4 273.6 264 267.8 265.7L261.2 248.7C284.4 241.9 305.6 235.8 330.3 228.7L322.3 204.9C274.6 216 237.4 216 189.6 204.9Z" class="selected" fill="#ffe0af" fill-opacity="1"></path><path d="M146.4 299.7L75.98 373.4L123.4 373.4L105 421.4L162.5 421.4L147.8 447L185.3 436.1L256 497.6L326.7 436.1L364.1 447L349.4 421.4L406.9 421.4L388.6 373.4L436 373.4L365.5 299.7L308.1 349.6L286.2 311.4L225.5 311.4L203.6 349.6Z" class="" fill="#a52604" fill-opacity="1"></path><path d="M237.6 325.4L274.4 325.4L274.4 343.4L237.6 343.4Z" class="" fill="#ffffff" fill-opacity="1"></path></g></g></svg>
  `,

};

/**
 * Obtiene un objeto HTMLImageElement listo para dibujar en el Canvas.
 * Genera la imagen bajo demanda y la guarda en caché.
 */
export const getIconImage = (iconKey: string): HTMLImageElement | null => {
  // 1. Si es un emoji (no está en SVG_DEFS), retornamos null para que el renderer use texto
  if (!SVG_DEFS[iconKey]) return null;

  // 2. Si ya está en caché, retornarla
  if (IMAGE_CACHE[iconKey]) {
    return IMAGE_CACHE[iconKey];
  }

  // 3. Crear nueva imagen desde el SVG String
  const img = new Image();
  const svgBlob = new Blob([SVG_DEFS[iconKey]], { type: 'image/svg+xml;charset=utf-8' });
  const url = URL.createObjectURL(svgBlob);
  
  img.src = url;
  
  // Guardar en caché
  IMAGE_CACHE[iconKey] = img;
  
  return img;
};

interface GameIconProps {
  icon: string;
  className?: string;
}

/**
 * Componente React para renderizar iconos en la UI.
 * Utiliza el mismo string SVG que el Canvas para consistencia total.
 */
export const GameIcon: React.FC<GameIconProps> = ({ icon, className }) => {
  const svgString = SVG_DEFS[icon];

  if (svgString) {
    return (
      <div 
        className={className} 
        dangerouslySetInnerHTML={{ __html: svgString }} 
        style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}
      />
    );
  }

  // Fallback a Emoji/Texto normal
  return <span className={className}>{icon}</span>;
};